

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>btgym.strategy package &mdash; BTGym 0.0.6 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="BTGym 0.0.6 documentation" href="index.html"/>
        <link rel="next" title="btgym.monitor package" href="btgym.monitor.html"/>
        <link rel="prev" title="btgym.datafeed module" href="btgym.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> BTGym
          

          
          </a>

          
            
            
              <div class="version">
                0.0.6
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Package Description</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro.html#installation">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro.html#quickstart">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro.html#environment-engine-description">Environment engine description</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro.html#a3c-framework">A3C framework</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="btgym.envs.html">btgym.envs package</a></li>
<li class="toctree-l1"><a class="reference internal" href="btgym.html">btgym.datafeed module</a></li>
<li class="toctree-l1"><a class="reference internal" href="btgym.html#module-btgym.dataserver">btgym.dataserver module</a></li>
<li class="toctree-l1"><a class="reference internal" href="btgym.html#module-btgym.server">btgym.server module</a></li>
<li class="toctree-l1"><a class="reference internal" href="btgym.html#module-btgym.spaces">btgym.spaces module</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">btgym.strategy package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#btgym-strategy-base-module">btgym.strategy.base module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#btgym-strategy-observers-module">btgym.strategy.observers module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="btgym.monitor.html">btgym.monitor package</a></li>
<li class="toctree-l1"><a class="reference internal" href="btgym.rendering.html">btgym.rendering package</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="btgym.algorithms.html">btgym.algorithms package</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="btgym.research.html">btgym.research package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">BTGym</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>btgym.strategy package</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/btgym.strategy.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="btgym-strategy-package">
<h1>btgym.strategy package<a class="headerlink" href="#btgym-strategy-package" title="Permalink to this headline">¶</a></h1>
<div class="section" id="btgym-strategy-base-module">
<h2>btgym.strategy.base module<a class="headerlink" href="#btgym-strategy-base-module" title="Permalink to this headline">¶</a></h2>
<span class="target" id="module-btgym.strategy.base"></span><dl class="class">
<dt id="btgym.strategy.base.BTgymBaseStrategy">
<em class="property">class </em><code class="descclassname">btgym.strategy.base.</code><code class="descname">BTgymBaseStrategy</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/strategy/base.html#BTgymBaseStrategy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.strategy.base.BTgymBaseStrategy" title="Permalink to this definition">¶</a></dt>
<dd><p>Controls Environment inner dynamics and backtesting logic. Provides gym’my (State, Action, Reward, Done, Info) data.
Any State, Reward and Info computation logic can be implemented by subclassing BTgymStrategy and overriding
get_state(), get_reward(), get_info(), is_done() and set_datalines() methods.
One can always go deeper and override __init__ () and next() methods for desired
server cerebro engine behaviour, including order execution logic etc.
Since it is bt.Strategy subclass, see:
<a class="reference external" href="https://www.backtrader.com/docu/strategy.html">https://www.backtrader.com/docu/strategy.html</a>
for more information.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>bt.observers.DrawDown observer will be automatically added to BTgymStrategy instance at runtime.</li>
<li>Since it is bt.Strategy subclass, see: <a class="reference external" href="https://www.backtrader.com/docu/strategy.html">https://www.backtrader.com/docu/strategy.html</a> for more information.</li>
</ul>
</div>
<p>Due to backtrader convention, any strategy args should be defined by <cite>params</cite> class attr. dictionary or passed
as kwargs to bt.Cerebro() class via .addstrategy() method.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>**kwargs</strong> – <p>params:                 dictionary containing following keys:</p>
<blockquote>
<div><dl class="docutils">
<dt>state_shape:        Observation state shape is dictionary of Gym spaces, by convention</dt>
<dd>first dimension of every Gym Box space is time embedding one;</dd>
</dl>
<p>drawdown_call:      finish episode when hitting this drawdown treshghold , in percent.
target_call:        finish episode when reaching this profit target, in percent.
dataset_stat:       summary descriptive statistics for entire dataset. Internal, updated by server.
episode_stat:       summary descriptive statistics for episode. Internal, updated by server.
portfolio_actions:  possible agent actions.
skip_frame:         number of environment steps to skip before returning next response,</p>
<blockquote>
<div>e.g. if set to 10 – agent will interact with environment every 10th step;
every other step agent action is assumed to be ‘hold’.</div></blockquote>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="btgym.strategy.base.BTgymBaseStrategy.update_sliding_stat">
<code class="descname">update_sliding_stat</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/strategy/base.html#BTgymBaseStrategy.update_sliding_stat"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.strategy.base.BTgymBaseStrategy.update_sliding_stat" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Updates all sliding statistics deques with latest-step values:</dt>
<dd><ul class="first last simple">
<li>normalized broker value</li>
<li>normalized broker cash</li>
<li>normalized exposure (position size)</li>
<li>position duration in steps, normalized wrt. max possible episode steps</li>
<li>exp. scaled episode duration in steps, normalized wrt. max possible episode steps</li>
<li><dl class="first docutils">
<dt>normalized decayed realized profit/loss for last closed trade</dt>
<dd>(or zero if no trades been closed within last step);</dd>
</dl>
</li>
<li>normalized profit/loss for current opened trade (unrealized p/l);</li>
<li>normalized best possible up to present point unrealized result for current opened trade;</li>
<li>normalized worst possible up to present point unrealized result for current opened trade;</li>
<li>one hot encoding for actions received;</li>
<li>rewards received (based on self.reward variable values);</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="btgym.strategy.base.BTgymBaseStrategy.action_one_hot">
<code class="descname">action_one_hot</code><span class="sig-paren">(</span><em>action</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/strategy/base.html#BTgymBaseStrategy.action_one_hot"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.strategy.base.BTgymBaseStrategy.action_one_hot" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns one-hot encoding for action.</p>
</dd></dl>

<dl class="method">
<dt id="btgym.strategy.base.BTgymBaseStrategy.action_norm">
<code class="descname">action_norm</code><span class="sig-paren">(</span><em>action</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/strategy/base.html#BTgymBaseStrategy.action_norm"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.strategy.base.BTgymBaseStrategy.action_norm" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns normalized in [0,1] real-valued encoding for action.</p>
</dd></dl>

<dl class="method">
<dt id="btgym.strategy.base.BTgymBaseStrategy.set_datalines">
<code class="descname">set_datalines</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/strategy/base.html#BTgymBaseStrategy.set_datalines"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.strategy.base.BTgymBaseStrategy.set_datalines" title="Permalink to this definition">¶</a></dt>
<dd><p>Default datalines are: Open, Low, High, Close, Volume.
Any other custom data lines, indicators, etc. should be explicitly defined by overriding this method.
Invoked once by Strategy.__init__().</p>
</dd></dl>

<dl class="method">
<dt id="btgym.strategy.base.BTgymBaseStrategy.get_state">
<code class="descname">get_state</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/strategy/base.html#BTgymBaseStrategy.get_state"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.strategy.base.BTgymBaseStrategy.get_state" title="Permalink to this definition">¶</a></dt>
<dd><p>Override this method, defining necessary calculations and return arbitrary shaped tensor.
It’s option either to compute entire featurized environment state or just pass raw price data
to RL algorithm featurizer module.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li><dl class="first docutils">
<dt>‘data’ referes to bt.startegy datafeeds and should be treated as such.</dt>
<dd><dl class="first last docutils">
<dt>Datafeed Lines that are not default to BTgymStrategy should be explicitly defined by</dt>
<dd>__init__() or define_datalines().</dd>
</dl>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>while iterating, ._get_raw_state() method is called just before this one,</dt>
<dd>so attr. <cite>self.raw_state</cite> is fresh and ready to use.</dd>
</dl>
</li>
<li>should update self.state variable</li>
</ul>
</div>
</dd></dl>

<dl class="method">
<dt id="btgym.strategy.base.BTgymBaseStrategy.get_reward">
<code class="descname">get_reward</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/strategy/base.html#BTgymBaseStrategy.get_reward"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.strategy.base.BTgymBaseStrategy.get_reward" title="Permalink to this definition">¶</a></dt>
<dd><p>Default reward estimator.</p>
<p>Computes <cite>dummy</cite> reward as log utility of current to initial portfolio value ratio.
Same principles as for state composer apply.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">scalar, float</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">self.reward value</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">should update self.reward variable.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="btgym.strategy.base.BTgymBaseStrategy.get_info">
<code class="descname">get_info</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/strategy/base.html#BTgymBaseStrategy.get_info"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.strategy.base.BTgymBaseStrategy.get_info" title="Permalink to this definition">¶</a></dt>
<dd><p>Composes information part of environment response,
can be any object. Override to own taste.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Due to ‘skip_frame’ feature, INFO part of environment response transmitted by server can be  a list
containing either all skipped frame’s info objects, i.e. [info[-9], info[-8], …, info[0]] or
just latest one, [info[0]]. This behaviour is set inside btgym.server._BTgymAnalyzer().next() method.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="btgym.strategy.base.BTgymBaseStrategy.get_done">
<code class="descname">get_done</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/strategy/base.html#BTgymBaseStrategy.get_done"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.strategy.base.BTgymBaseStrategy.get_done" title="Permalink to this definition">¶</a></dt>
<dd><p>Episode termination estimator,
defines any trading logic conditions episode stop is called upon, e.g. &lt;OMG! Stop it, we became too rich!&gt;.
It is just a structural a convention method. Default method is empty.</p>
<dl class="docutils">
<dt>Expected to return:</dt>
<dd>tuple (&lt;is_done, type=bool&gt;, &lt;message, type=str&gt;).</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="btgym.strategy.base.BTgymBaseStrategy.notify_order">
<code class="descname">notify_order</code><span class="sig-paren">(</span><em>order</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/strategy/base.html#BTgymBaseStrategy.notify_order"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.strategy.base.BTgymBaseStrategy.notify_order" title="Permalink to this definition">¶</a></dt>
<dd><p>Shamelessly taken from backtrader tutorial.</p>
</dd></dl>

<dl class="method">
<dt id="btgym.strategy.base.BTgymBaseStrategy.next">
<code class="descname">next</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/strategy/base.html#BTgymBaseStrategy.next"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.strategy.base.BTgymBaseStrategy.next" title="Permalink to this definition">¶</a></dt>
<dd><p>Default implementation.
Defines one step environment routine for server ‘Episode mode’;
At least, it should handle order execution logic according to action received.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="btgym-strategy-observers-module">
<h2>btgym.strategy.observers module<a class="headerlink" href="#btgym-strategy-observers-module" title="Permalink to this headline">¶</a></h2>
<span class="target" id="module-btgym.strategy.observers"></span><dl class="class">
<dt id="btgym.strategy.observers.Reward">
<em class="property">class </em><code class="descclassname">btgym.strategy.observers.</code><code class="descname">Reward</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/strategy/observers.html#Reward"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.strategy.observers.Reward" title="Permalink to this definition">¶</a></dt>
<dd><p>Keeps track of reward values.</p>
</dd></dl>

<dl class="class">
<dt id="btgym.strategy.observers.Position">
<em class="property">class </em><code class="descclassname">btgym.strategy.observers.</code><code class="descname">Position</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/strategy/observers.html#Position"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.strategy.observers.Position" title="Permalink to this definition">¶</a></dt>
<dd><p>Keeps track of position size.</p>
</dd></dl>

<dl class="class">
<dt id="btgym.strategy.observers.NormPnL">
<em class="property">class </em><code class="descclassname">btgym.strategy.observers.</code><code class="descname">NormPnL</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btgym/strategy/observers.html#NormPnL"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#btgym.strategy.observers.NormPnL" title="Permalink to this definition">¶</a></dt>
<dd><p>Keeps track of PnL stats.</p>
</dd></dl>

</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="btgym.monitor.html" class="btn btn-neutral float-right" title="btgym.monitor package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="btgym.html" class="btn btn-neutral" title="btgym.datafeed module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Andrew Muzikin.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.0.6',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>